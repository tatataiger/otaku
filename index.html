<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="é‡çƒã‚¹ã‚³ã‚¢">
    <meta name="description" content="è‰é‡çƒå¤§ä¼šã®ã‚¹ã‚³ã‚¢ç®¡ç†ãƒ»ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ å…±æœ‰ã‚·ã‚¹ãƒ†ãƒ ">
    <title>è‰é‡çƒå¤§ä¼š ã‚¹ã‚³ã‚¢ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ¥</text></svg>">
</head>
<body>
    <header>
        <h1>ğŸ¥ è‰é‡çƒå¤§ä¼š ã‚¹ã‚³ã‚¢ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
        <div class="tournament-selector">
            <select id="tournamentSelect" onchange="switchTournament()">
                <option value="">-- å¤§ä¼šã‚’é¸æŠ --</option>
            </select>
            <button class="btn btn-small btn-primary" onclick="openNewTournamentModal()">ï¼‹ æ–°è¦å¤§ä¼š</button>
        </div>
        <nav>
            <ul>
                <li><a href="#" class="nav-link active" data-page="home">ãƒ›ãƒ¼ãƒ </a></li>
                <li><a href="#" class="nav-link" data-page="teams">ãƒãƒ¼ãƒ ç®¡ç†</a></li>
                <li><a href="#" class="nav-link" data-page="schedule">è©¦åˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</a></li>
                <li><a href="#" class="nav-link" data-page="standings">é †ä½è¡¨</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ -->
        <section id="home" class="page active">
            <div class="container">
                <div id="noTournamentMessage" class="empty-state" style="display: none;">
                    <p>ğŸ† å¤§ä¼šãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
                    <button class="btn btn-primary" onclick="openNewTournamentModal()">æ–°è¦å¤§ä¼šã‚’ä½œæˆ</button>
                </div>
                <div id="tournamentContent">
                    <h2>å¤§ä¼šæƒ…å ±</h2>
                    <div class="tournament-info">
                        <div class="info-card">
                            <h3>å¤§ä¼šå</h3>
                            <input type="text" id="tournamentName" placeholder="å¤§ä¼šåã‚’å…¥åŠ›">
                        </div>
                        <div class="info-card">
                            <h3>é–‹å‚¬æ—¥</h3>
                            <input type="date" id="tournamentDate">
                        </div>
                        <div class="info-card">
                            <h3>å¤§ä¼šå½¢å¼</h3>
                            <span id="tournamentType">é€šå¸¸</span>
                        </div>
                        <div class="info-card">
                            <h3>ç™»éŒ²ãƒãƒ¼ãƒ æ•°</h3>
                            <span id="teamCount">0</span> ãƒãƒ¼ãƒ 
                        </div>
                    </div>
                    <div class="quick-actions">
                        <button class="btn btn-primary" onclick="showPage('teams')">ãƒãƒ¼ãƒ ã‚’ç™»éŒ²ã™ã‚‹</button>
                        <button class="btn btn-secondary" onclick="showPage('schedule')">è©¦åˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¦‹ã‚‹</button>
                        <button class="btn btn-success" onclick="openShareModal()">ğŸ”— ã“ã®å¤§ä¼šã‚’å…±æœ‰</button>
                        <button class="btn btn-danger" onclick="openDeleteTournamentModal()">ã“ã®å¤§ä¼šã‚’å‰Šé™¤</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ãƒãƒ¼ãƒ ç®¡ç†ãƒšãƒ¼ã‚¸ -->
        <section id="teams" class="page">
            <div class="container">
                <h2>ãƒãƒ¼ãƒ ç®¡ç†</h2>
                
                <!-- é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ç”¨ -->
                <div id="normalTeamMode">
                    <div class="team-form">
                        <input type="text" id="teamName" placeholder="ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
                        <button class="btn btn-primary" onclick="addTeam()">ãƒãƒ¼ãƒ ã‚’è¿½åŠ </button>
                    </div>
                    <div class="team-list">
                        <h3>ç™»éŒ²ãƒãƒ¼ãƒ ä¸€è¦§</h3>
                        <ul id="teamList"></ul>
                    </div>
                    <div class="generate-schedule">
                        <button class="btn btn-success" onclick="generateSchedule()">ç·å½“ãŸã‚Šæˆ¦ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ç”Ÿæˆ</button>
                    </div>
                </div>
                
                <!-- å¯¾æŠ—æˆ¦ãƒ¢ãƒ¼ãƒ‰ç”¨ -->
                <div id="taikoTeamMode" style="display: none;">
                    <div class="camp-container">
                        <!-- é™£å–¶A -->
                        <div class="camp-section camp-a">
                            <h3>ğŸ”´ é™£å–¶A</h3>
                            <div class="camp-name-input">
                                <input type="text" id="campAName" placeholder="é™£å–¶åï¼ˆä¾‹ï¼šæ±è»ï¼‰">
                                <button class="btn btn-small btn-secondary" onclick="saveCampName('A')">ä¿å­˜</button>
                            </div>
                            <div class="team-form">
                                <input type="text" id="teamNameA" placeholder="ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
                                <button class="btn btn-primary" onclick="addTeamToCamp('A')">è¿½åŠ </button>
                            </div>
                            <ul id="teamListA" class="camp-team-list"></ul>
                        </div>
                        
                        <!-- é™£å–¶B -->
                        <div class="camp-section camp-b">
                            <h3>ğŸ”µ é™£å–¶B</h3>
                            <div class="camp-name-input">
                                <input type="text" id="campBName" placeholder="é™£å–¶åï¼ˆä¾‹ï¼šè¥¿è»ï¼‰">
                                <button class="btn btn-small btn-secondary" onclick="saveCampName('B')">ä¿å­˜</button>
                            </div>
                            <div class="team-form">
                                <input type="text" id="teamNameB" placeholder="ãƒãƒ¼ãƒ åã‚’å…¥åŠ›">
                                <button class="btn btn-primary" onclick="addTeamToCamp('B')">è¿½åŠ </button>
                            </div>
                            <ul id="teamListB" class="camp-team-list"></ul>
                        </div>
                    </div>
                    
                    <div class="taiko-actions">
                        <button class="btn btn-success" onclick="generateTaikoSchedule()">äºˆé¸ï¼ˆé™£å–¶å†…ç·å½“ãŸã‚Šï¼‰ã‚’é–‹å§‹</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- è©¦åˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ -->
        <section id="schedule" class="page">
            <div class="container">
                <h2>è©¦åˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</h2>
                
                <!-- é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ç”¨ -->
                <div id="normalScheduleMode">
                    <div id="scheduleList" class="schedule-list"></div>
                </div>
                
                <!-- å¯¾æŠ—æˆ¦ãƒ¢ãƒ¼ãƒ‰ç”¨ -->
                <div id="taikoScheduleMode" style="display: none;">
                    <div class="taiko-phase-tabs">
                        <button class="phase-tab active" onclick="showTaikoPhase('preliminary')">äºˆé¸ï¼ˆé™£å–¶å†…ï¼‰</button>
                        <button class="phase-tab" onclick="showTaikoPhase('final')">æœ¬æˆ¦ï¼ˆå¯¾æŠ—æˆ¦ï¼‰</button>
                    </div>
                    
                    <!-- äºˆé¸ -->
                    <div id="preliminaryPhase" class="taiko-phase">
                        <div class="camp-schedules">
                            <div class="camp-schedule camp-a">
                                <h3>ğŸ”´ é™£å–¶A äºˆé¸</h3>
                                <div id="matchListA" class="schedule-list"></div>
                            </div>
                            <div class="camp-schedule camp-b">
                                <h3>ğŸ”µ é™£å–¶B äºˆé¸</h3>
                                <div id="matchListB" class="schedule-list"></div>
                            </div>
                        </div>
                        <div class="taiko-actions">
                            <button id="finalizePreliminaryBtn" class="btn btn-success" onclick="finalizePreliminaryUI()">äºˆé¸çµ‚äº† â†’ å½¹è·ã‚’ç¢ºå®š</button>
                        </div>
                    </div>
                    
                    <!-- æœ¬æˆ¦ -->
                    <div id="finalPhase" class="taiko-phase" style="display: none;">
                        <div class="final-matchups">
                            <h3>âš”ï¸ æœ¬æˆ¦å¯¾æ±º</h3>
                            <div id="finalMatchList" class="final-match-list"></div>
                        </div>
                        <div id="taikoResultContainer"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- é †ä½è¡¨ãƒšãƒ¼ã‚¸ -->
        <section id="standings" class="page">
            <div class="container">
                <h2>é †ä½è¡¨</h2>
                
                <!-- é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ç”¨ -->
                <div id="normalStandingsMode">
                    <table id="standingsTable" class="standings-table">
                        <thead>
                            <tr>
                                <th>é †ä½</th>
                                <th>ãƒãƒ¼ãƒ å</th>
                                <th>å‹ç‚¹</th>
                                <th>è©¦åˆ</th>
                                <th>å‹</th>
                                <th>æ•—</th>
                                <th>å¼•åˆ†</th>
                                <th>å‹ç‡</th>
                                <th>å¾—ç‚¹</th>
                                <th>å¤±ç‚¹</th>
                                <th>å¾—å¤±ç‚¹å·®</th>
                            </tr>
                        </thead>
                        <tbody id="standingsBody"></tbody>
                    </table>
                    
                    <h3 class="section-title">å¯¾æˆ¦è¡¨</h3>
                    <div id="matchupTable" class="matchup-table-container"></div>
                </div>
                
                <!-- å¯¾æŠ—æˆ¦ãƒ¢ãƒ¼ãƒ‰ç”¨ -->
                <div id="taikoStandingsMode" style="display: none;">
                    <div class="camp-standings">
                        <div class="camp-standing camp-a">
                            <h3>ğŸ”´ é™£å–¶A é †ä½</h3>
                            <table class="standings-table compact">
                                <thead>
                                    <tr>
                                        <th>é †ä½</th>
                                        <th>ãƒãƒ¼ãƒ </th>
                                        <th>å‹ç‚¹</th>
                                        <th>å‹æ•—åˆ†</th>
                                        <th>å¾—å¤±å·®</th>
                                    </tr>
                                </thead>
                                <tbody id="standingsBodyA"></tbody>
                            </table>
                        </div>
                        <div class="camp-standing camp-b">
                            <h3>ğŸ”µ é™£å–¶B é †ä½</h3>
                            <table class="standings-table compact">
                                <thead>
                                    <tr>
                                        <th>é †ä½</th>
                                        <th>ãƒãƒ¼ãƒ </th>
                                        <th>å‹ç‚¹</th>
                                        <th>å‹æ•—åˆ†</th>
                                        <th>å¾—å¤±å·®</th>
                                    </tr>
                                </thead>
                                <tbody id="standingsBodyB"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- ã‚¹ã‚³ã‚¢å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="scoreModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>ã‚¹ã‚³ã‚¢å…¥åŠ›</h2>
            <div class="score-input-form">
                <div class="team-score">
                    <label id="homeTeamLabel">ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ </label>
                    <input type="number" id="homeScore" min="0" value="0">
                </div>
                <div class="vs">VS</div>
                <div class="team-score">
                    <label id="awayTeamLabel">ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ </label>
                    <input type="number" id="awayScore" min="0" value="0">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveScore()">ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- æ–°è¦å¤§ä¼šä½œæˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="newTournamentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeNewTournamentModal()">&times;</span>
            <h2>ğŸ† æ–°è¦å¤§ä¼šã‚’ä½œæˆ</h2>
            <div class="form-group">
                <label for="newTournamentName">å¤§ä¼šå</label>
                <input type="text" id="newTournamentName" placeholder="ä¾‹: ç¬¬1å› æ˜¥å­£å¤§ä¼š">
            </div>
            <div class="form-group">
                <label for="newTournamentDate">é–‹å‚¬æ—¥</label>
                <input type="date" id="newTournamentDate">
            </div>
            <div class="form-group">
                <label>å¤§ä¼šå½¢å¼</label>
                <div class="radio-group">
                    <label class="radio-label">
                        <input type="radio" name="tournamentType" id="tournamentTypeNormal" value="normal" checked>
                        <span>ğŸ† é€šå¸¸ç·å½“ãŸã‚Šæˆ¦</span>
                    </label>
                    <label class="radio-label">
                        <input type="radio" name="tournamentType" id="tournamentTypeTaiko" value="taiko">
                        <span>âš”ï¸ å¯¾æŠ—æˆ¦ï¼ˆé™£å–¶åˆ¥ï¼‰</span>
                    </label>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="createNewTournament()">ä½œæˆ</button>
                <button class="btn btn-secondary" onclick="closeNewTournamentModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- äºˆé¸ã‚¹ã‚³ã‚¢å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="campScoreModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCampScoreModal()">&times;</span>
            <h2 id="campScoreModalTitle">äºˆé¸ã‚¹ã‚³ã‚¢å…¥åŠ›</h2>
            <div class="score-input-form">
                <div class="team-score">
                    <label id="campHomeTeamLabel">ãƒ›ãƒ¼ãƒ ãƒãƒ¼ãƒ </label>
                    <input type="number" id="campHomeScore" min="0" value="0">
                </div>
                <div class="vs">VS</div>
                <div class="team-score">
                    <label id="campAwayTeamLabel">ã‚¢ã‚¦ã‚§ã‚¤ãƒãƒ¼ãƒ </label>
                    <input type="number" id="campAwayScore" min="0" value="0">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveCampScore()">ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="closeCampScoreModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- æ±ºå‹ã‚¹ã‚³ã‚¢å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="finalScoreModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeFinalScoreModal()">&times;</span>
            <h2 id="finalScoreModalTitle">æ±ºå‹ã‚¹ã‚³ã‚¢å…¥åŠ›</h2>
            <div class="score-input-form">
                <div class="team-score">
                    <label id="finalTeamALabel">é™£å–¶A</label>
                    <input type="number" id="finalTeamAScore" min="0" value="0">
                </div>
                <div class="vs">VS</div>
                <div class="team-score">
                    <label id="finalTeamBLabel">é™£å–¶B</label>
                    <input type="number" id="finalTeamBScore" min="0" value="0">
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="saveFinalScore()">ä¿å­˜</button>
                <button class="btn btn-secondary" onclick="closeFinalScoreModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- å¤§ä¼šå‰Šé™¤ç¢ºèªãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="deleteTournamentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteTournamentModal()">&times;</span>
            <h2>âš ï¸ å¤§ä¼šã‚’å‰Šé™¤</h2>
            <p class="warning-text">ã“ã®å¤§ä¼šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ<br>å…¨ã¦ã®ãƒãƒ¼ãƒ ã¨è©¦åˆçµæœãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚</p>
            <p id="deleteTournamentName" class="delete-target"></p>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="confirmDeleteTournament()">å‰Šé™¤ã™ã‚‹</button>
                <button class="btn btn-secondary" onclick="closeDeleteTournamentModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            </div>
        </div>
    </div>

    <!-- å¤§ä¼šå…±æœ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="shareTournamentModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeShareModal()">&times;</span>
            <h2>ğŸ”— å¤§ä¼šã‚’å…±æœ‰</h2>
            <p>ä»¥ä¸‹ã®URLã‚’å…±æœ‰ã™ã‚‹ã¨ã€ä»–ã®äººã¨åŒã˜å¤§ä¼šã‚’ä¸€ç·’ã«ç·¨é›†ã§ãã¾ã™ã€‚</p>
            <div class="share-url-container">
                <input type="text" id="shareUrl" readonly>
                <button class="btn btn-primary" onclick="copyShareUrl()">ã‚³ãƒ”ãƒ¼</button>
            </div>
            <p class="share-note">â€» URLã‚’çŸ¥ã£ã¦ã„ã‚‹äººã¯èª°ã§ã‚‚ç·¨é›†ã§ãã¾ã™</p>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeShareModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- æ¥ç¶šçŠ¶æ…‹è¡¨ç¤º -->
    <div id="connectionStatus" class="connection-status">
        <span class="status-icon">ğŸ”´</span>
        <span class="status-text">ã‚ªãƒ•ãƒ©ã‚¤ãƒ³</span>
    </div>

    <footer>
        <p>&copy; 2025 è‰é‡çƒå¤§ä¼š ã‚¹ã‚³ã‚¢ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p>
    </footer>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot, collection, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyBnumCQ8P6eW0vGJ88U4MBIQI7_eHkdP3w",
            authDomain: "otaku-baseball.firebaseapp.com",
            projectId: "otaku-baseball",
            storageBucket: "otaku-baseball.firebasestorage.app",
            messagingSenderId: "406894982542",
            appId: "1:406894982542:web:9a42156d9bc8d3990a20df",
            measurementId: "G-3FNG7F9Q53"
        };

        // FirebaseãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
        if (firebaseConfig.apiKey === "YOUR_API_KEY") {
            console.warn('Firebaseæœªè¨­å®š: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™');
            window.firebaseReady = false;
        } else {
            try {
                // FirebaseåˆæœŸåŒ–
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);

                // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
                window.firebaseDb = db;
                window.firebaseDoc = doc;
                window.firebaseSetDoc = setDoc;
                window.firebaseGetDoc = getDoc;
                window.firebaseOnSnapshot = onSnapshot;
                window.firebaseCollection = collection;
                window.firebaseDeleteDoc = deleteDoc;
                window.firebaseReady = true;

                // Firebaseæº–å‚™å®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆ
                window.dispatchEvent(new Event('firebaseReady'));
            } catch (error) {
                console.error('FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                window.firebaseReady = false;
            }
        }
    </script>
    <script src="js/app.js"></script>
</body>
</html>
